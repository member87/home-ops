# Pi-hole Helm Chart Values
# Configures Pi-hole for DNS ad-blocking in home-ops cluster

# Admin password disabled - protected by Tinyauth/Pocket ID
# Setting to null prevents the FTLCONF_webserver_api_password env var from being created
adminPassword: null
webPassword: ""

# Persistent storage for Pi-hole data
persistentVolumeClaim:
  enabled: true
  size: "1Gi"
  accessModes:
    - ReadWriteOnce

# DNS Service Configuration - using LoadBalancer with MetalLB
# externalTrafficPolicy: Cluster ensures kube-proxy creates DNAT rules on ALL
# nodes, required for Tailscale subnet router to forward DNS to 10.0.0.201
serviceDns:
  type: LoadBalancer
  externalTrafficPolicy: Cluster
  loadBalancerIP: "10.0.0.201"
  port: 53
  annotations:
    metallb.universe.tf/allow-shared-ip: pihole-svc

# Web Interface Service Configuration
# externalTrafficPolicy must match serviceDns for MetalLB shared IP
serviceWeb:
  type: LoadBalancer
  externalTrafficPolicy: Cluster
  loadBalancerIP: "10.0.0.201"
  http:
    enabled: true
    port: 80
  https:
    enabled: true
    port: 443
  annotations:
    metallb.universe.tf/allow-shared-ip: pihole-svc

# DHCP Service - disable if not needed
serviceDhcp:
  enabled: false

# DNS Configuration
DNS1: "1.1.1.1"
DNS2: "1.0.0.1"

# DNSMasq custom configuration
dnsmasq:
  enableCustomDnsMasq: true
  customDnsEntries:
    # Wildcard DNS for lab domain - routes all *.lab.jackhumes.com to Traefik
    - address=/.lab.jackhumes.com/10.0.0.200
    # Add custom DNS entries for your local services
    - address=/pihole.home.local/10.0.0.201
    - address=/traefik.home.local/10.0.0.200
  customCnameEntries: []
  upstreamServers: []

# Environment variables
extraEnvVars:
  TZ: "UTC"
  FTLCONF_dns_listeningMode: "all"
  FTLCONF_misc_dnsmasq_lines: "address=/.lab.jackhumes.com/10.0.0.200"

# Pod DNS Configuration
podDnsConfig:
  enabled: true
  policy: "None"
  nameservers:
    - 127.0.0.1
    - 1.1.1.1

# Resources
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Additional blocklists
adlists:
  - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
  - https://dbl.oisd.nl/

# Monitoring
monitoring:
  podMonitor:
    enabled: false
  sidecar:
    enabled: false
